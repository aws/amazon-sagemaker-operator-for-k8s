# This CodeBuild project is run using the docker:stable-dind container

version: 0.2      
phases:
  build:
    commands:
       # Docker engine takes few seconds to start
       - service docker start 
       # TODO: Make it polling
       - sleep 1
       # Add AWSCLI and bash
       - (apk add --update python python-dev py-pip build-base bash && pip install awscli --upgrade)
       # Build new integration test container
       - (IMG=$INTEGRATION_CONTAINER_REPOSITORY bash codebuild/scripts/build_deploy_integration_container.sh)